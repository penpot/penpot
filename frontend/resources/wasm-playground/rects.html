<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>WASM + WebGL2 Canvas</title>
  <style>
    body {
      margin: 0;
      background: #111;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }
    canvas {
      width: 100%;
      height: 100%;
      position: absolute;
    }
  </style>
</head>
<body>
  <canvas id="canvas"></canvas>
  <script type="module">
    import initWasmModule from '/js/render_wasm.js';
    import {
      init, assignCanvas, hexToU32ARGB, getRandomInt, getRandomColor,
      getRandomFloat, useShape, setShapeChildren, setupInteraction
    } from './js/lib.js';

    const canvas = document.getElementById("canvas");
    canvas.width =  window.innerWidth;
    canvas.height = window.innerHeight;

    initWasmModule().then(Module => {
      init(Module);
      assignCanvas(canvas);
      Module._set_canvas_background(hexToU32ARGB("#FABADA", 1));
      Module._set_view(0.033, 0, 0);
      setupInteraction(canvas);

      const children = [];
      for (let i = 0; i < 100000; i++) {
        const uuid = crypto.randomUUID();
        children.push(uuid);

        useShape(uuid);
        Module._set_parent(0, 0, 0, 0);
        Module._set_shape_type(3);
        console.log("canvas.width", canvas.width)
        const x1 = getRandomInt(0, canvas.width * 30);
        const y1 = getRandomInt(0, canvas.height * 30);
        const width = getRandomInt(200, 400);
        const height = getRandomInt(200, 400);
        Module._set_shape_selrect(x1, y1, x1 + width, y1 + height);

        const color = getRandomColor();
        const argb = hexToU32ARGB(color, getRandomFloat(0.1, 1.0));
        Module._add_shape_solid_fill(argb);
      }

      useShape("00000000-0000-0000-0000-000000000000");
      setShapeChildren(children);
      Module._render(Date.now());
    });
    
  </script>
</body>
</html>
